require=function(r,e,n){function t(n,o){function i(r){return t(i.resolve(r))}function f(e){return r[n][1][e]||e}if(!e[n]){if(!r[n]){var c="function"==typeof require&&require;if(!o&&c)return c(n,!0);if(u)return u(n,!0);var l=new Error("Cannot find module '"+n+"'");throw l.code="MODULE_NOT_FOUND",l}i.resolve=f;var a=e[n]=new t.Module;r[n][0].call(a.exports,i,a,a.exports)}return e[n].exports}function o(){this.bundle=t,this.exports={}}var u="function"==typeof require&&require;t.Module=o,t.modules=r,t.cache=e,t.parent=u;for(var i=0;i<n.length;i++)t(n[i]);return t}({3:[function(require,module,exports) {

},{}],8:[function(require,module,exports) {
"use strict";"use-strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=-1!==navigator.userAgent.indexOf("MSIE")||navigator.appVersion.indexOf("Trident/")>0,o=null,r=null;e?(window.onYouTubeIframeAPIReady=function(){o.resolve()},exports.videoPromise=o=$.Deferred(),window.onMapReady=function(){r.resolve()},exports.mapPromise=r=$.Deferred()):(exports.videoPromise=o=new Promise(function(e,o){window.onYouTubeIframeAPIReady=function(){e()}}),exports.mapPromise=r=new Promise(function(e,o){window.onMapReady=function(){e()}})),exports.videoPromise=o,exports.mapPromise=r;
},{}],4:[function(require,module,exports) {
"use strict";"use-strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),t=require("./../css/videotrack.css"),r=i(t),a=require("./promise.js");function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=function(t){function r(e){n(this,r);var t=o(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return t.props.updateMarker=t.props.updateMarker||500,t.props.zoom=t.props.zoom||15,t.timerId=null,t.player=null,t.timeArray=new Array,t.lonArray=new Array,t.latArray=new Array,t.bikeMarker=null,t.googleMap=null,t.kmlPromise=$.ajax({type:"GET",url:t.props.trackUrl,dataType:"xml"}),t}return s(r,React.Component),e(r,[{key:"componentDidMount",value:function(){a.videoPromise.then(this.initPlayer.bind(this)),Promise.all([this.kmlPromise,a.mapPromise]).then(this.initTrack.bind(this),this.rejectTrack.bind(this))}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){var e=this;return React.createElement("div",{className:"vt-wrapper",ref:function(t){return e._wrapperComp=t}},React.createElement("div",{className:"vt-text"},this.props.title),React.createElement("div",{className:"vt-video",ref:function(t){return e._videoComp=t}}),React.createElement("div",{className:"vt-track",ref:function(t){return e._trackComp=t}}))}},{key:"initPlayer",value:function(){this.player=new YT.Player(this._videoComp,{videoId:this.props.videoid,playerVars:{rel:0,showinfo:0,modestbranding:1},events:{onReady:this.onPlayerReady.bind(this),onStateChange:this.onPlayerStateChange.bind(this)}});var e=$(this._wrapperComp).find(".vt-video");e.attr("height",""),e.attr("width","")}},{key:"onPlayerReady",value:function(e){}},{key:"onPlayerStateChange",value:function(e){this.player&&(e.data==YT.PlayerState.PLAYING?(this.timerId&&(window.clearInterval(this.timerId),this.timerId=null),this.timerId=window.setInterval(function(){this.onPlayerUpdate()}.bind(this),this.props.updateMarker)):e.data!=YT.PlayerState.ENDED&&e.data!=YT.PlayerState.PAUSED||this.timerId&&(window.clearInterval(this.timerId),this.timerId=null))}},{key:"onPlayerUpdate",value:function(){if(this.player){var e=this.findKMLPoint(this.player.getCurrentTime()),t=new google.maps.LatLng(this.latArray[e],this.lonArray[e]);this.bikeMarker?this.bikeMarker.setPosition(t):this.bikeMarker=new google.maps.Marker({position:t,map:this.googleMap,icon:"http://babaosoftware.com/bikinginstyle.com/images/"+(this.googleMap.getMapTypeId()==google.maps.MapTypeId.SATELLITE?"bikeiconyellow.png":"bikeiconblue.png")}),this.bringMarkerIntoView()}}},{key:"bringMarkerIntoView",value:function(){if(this.bikeMarker){var e=this.googleMap.getBounds(),t=this.bikeMarker.getPosition();e.contains(t)||this.googleMap.panTo(t)}}},{key:"distance",value:function(e,t,r,a,i){var n=Math.PI*e/180,o=Math.PI*r/180,s=t-a,l=Math.PI*s/180,p=Math.sin(n)*Math.sin(o)+Math.cos(n)*Math.cos(o)*Math.cos(l);return p=60*(p=180*(p=Math.acos(p))/Math.PI)*1.1515,"K"==i&&(p*=1.609344),"N"==i&&(p*=.8684),p}},{key:"findKMLPoint",value:function(e){for(var t=0;t<this.timeArray.length;t++){if(this.timeArray[t]==e)return t;if(this.timeArray[t]>e)return t>0?t-1:0}return this.timeArray.length-1}},{key:"rejectTrack",value:function(){console.warn("Failed to load kml!")}},{key:"initTrack",value:function(e){var t=e[0],r=t.getElementsByTagNameNS("http://www.google.com/kml/ext/2.2","Track")[0].getElementsByTagNameNS("*","when"),a=t.getElementsByTagNameNS("http://www.google.com/kml/ext/2.2","coord");this.timeArray.push(0);for(var i=new Date(r[0].textContent),n=1;n<r.length;n++){var o=new Date(r[n].textContent).getTime()-i.getTime();this.timeArray.push(Math.round(o/1e3))}for(n=0;n<a.length;n++){var s=a[n].textContent.split(" ");this.lonArray.push(s[0]),this.latArray.push(s[1])}if(0!=a.length){var l={mapTypeId:google.maps.MapTypeId.SATELLITE,zoom:this.props.zoom,center:new google.maps.LatLng(this.latArray[0],this.lonArray[0])};this.googleMap=new google.maps.Map(this._trackComp,l),google.maps.event.addListener(this.googleMap,"maptypeid_changed",function(){this.bikeMarker&&this.bikeMarker.setIcon("http://babaosoftware.com/bikinginstyle.com/images/"+(this.googleMap.getMapTypeId()==google.maps.MapTypeId.SATELLITE?"bikeiconyellow.png":"bikeiconblue.png"))}.bind(this)),(new google.maps.BicyclingLayer).setMap(this.googleMap);var p=this.props.trackUrl;new google.maps.KmlLayer({url:p,map:this.googleMap,preserveViewport:!0,suppressInfoWindows:!0}).addListener("click",function(e){for(var t=0,r=1e4,a=0;a<this.timeArray.length;a++){var i=this.distance(e.latLng.lat(),e.latLng.lng(),this.latArray[a],this.lonArray[a]);i<r&&(r=i,t=a)}var n=new google.maps.LatLng(this.latArray[t],this.lonArray[t]);this.bikeMarker&&this.bikeMarker.setPosition(n),this.player.seekTo(this.timeArray[t],!0)}.bind(this))}}}]),r}();exports.default=l;
},{"./../css/videotrack.css":3,"./promise.js":8}],1:[function(require,module,exports) {
"use strict";"use-strict";var e=require("./../css/main.css"),t=a(e),r=require("./videotrack.js"),i=a(r);function a(e){return e&&e.__esModule?e:{default:e}}function c(){ReactDOM.render(React.createElement(i.default,{trackUrl:"http://babaosoftware.com/bikinginstyle.com/kmlfiles/iBTdg9rbfvc.kml",videoid:"iBTdg9rbfvc",title:"Central Park Bike Lap"}),$(".video-track-wrapper")[0])}$(document).ready(function(){c()});
},{"./../css/main.css":3,"./videotrack.js":4}]},{},[1])